<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOLO LEVELING BOARD GAME</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@1,900&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --sys-blue: #00d2ff; --sys-red: #ff003c; --sys-gold: #ffcc00; --sys-silver: #c0c0c0; --sys-green: #00ff00; }
        body { background: #000; color: white; font-family: 'Exo 2', sans-serif; margin: 0; overflow: hidden; }
        h1, h2, h3 { font-family: 'Orbitron'; font-style: italic; color: var(--sys-blue); text-shadow: 0 0 10px var(--sys-blue); }
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100vh; width: 100vw; position: absolute; }
        .active { display: flex !important; }
        
        /* Buttons & Inputs */
        .sys-btn { background: #000; border: 2px solid var(--sys-blue); color: var(--sys-blue); padding: 10px 40px; font-family: 'Orbitron'; cursor: pointer; margin: 10px; font-weight: 900; clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%); width: 250px; text-transform: uppercase; transition: 0.2s; }
        .sys-btn:hover { background: var(--sys-blue); color: #000; }
        .sys-input { padding: 15px; background: #000; border: 1px solid var(--sys-blue); color: #fff; width: 300px; margin: 10px; font-family: 'Orbitron'; outline: none; }
        
        /* Admin Glow */
        .admin-glow { color: var(--sys-gold) !important; text-shadow: 0 0 15px var(--sys-gold), 0 0 5px #fff; font-weight: 900; animation: admin-pulse 2s infinite ease-in-out; }
        @keyframes admin-pulse { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5) drop-shadow(0 0 10px var(--sys-gold)); } }
        .admin-chat-msg { background: rgba(255, 204, 0, 0.1); border-left: 3px solid var(--sys-gold); padding-left: 5px; margin: 2px 0; }

        /* Board - Fixed 15x15 Map */
        #game-board { display: grid; grid-template-columns: repeat(15, 42px); gap: 2px; background: #111; border: 4px solid var(--sys-blue); }
        .cell { width: 42px; height: 42px; background: #000; position: relative; border: 0.5px solid #1a1a1a; box-sizing: border-box; }
        .valid-move { box-shadow: inset 0 0 0 3px var(--sys-blue); cursor: pointer; z-index: 5; }
        
        /* Characters */
        .humanoid { position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 24px; height: 30px; z-index: 10; pointer-events: none; }
        .h-head { width: 10px; height: 10px; border-radius: 50%; border: 1px solid white; margin: 0 auto; }
        .h-body { width: 20px; height: 15px; border: 1px solid white; border-radius: 4px 4px 0 0; }
        .name-tag { position: absolute; top: -22px; left: 50%; transform: translateX(-50%); font-size: 10px; white-space: nowrap; font-weight: 900; background: #000; border: 1px solid #444; padding: 1px 4px; display: flex; flex-direction: column; align-items: center; z-index: 20; }
        
        /* Sidebars & HUD */
        .hud-left { width: 280px; background: rgba(0,0,0,0.9); border-right: 2px solid var(--sys-blue); padding: 15px; display: flex; flex-direction: column; height: 700px; overflow-y: auto; margin-right: 20px;}
        .hud-right { width: 280px; background: rgba(0,0,0,0.9); border-left: 2px solid var(--sys-blue); padding: 15px; display: flex; flex-direction: column; height: 700px; overflow-y: auto; margin-left: 20px;}
        
        .party-member { font-size: 16px; font-weight: 900; margin-bottom: 8px; border-bottom: 1px solid #222; padding: 5px 0; }
        
        /* Rank Guide Table */
        .rank-guide-table { width: 100%; font-size: 10px; border-collapse: collapse; margin-top: auto; color: #888; font-family: 'Orbitron'; }
        .rank-guide-table td { border-bottom: 1px solid #222; padding: 2px; }
        .rank-guide-title { color: var(--sys-gold); font-size: 12px; margin-top: 10px; font-weight: 900; border-bottom: 2px solid var(--sys-gold); }

        /* Combat Panel */
        #vs-panel { display: none; background: rgba(20,0,0,0.9); border: 2px solid var(--sys-red); padding: 10px; margin-bottom: 15px; flex-direction: column; align-items: center; box-shadow: 0 0 15px var(--sys-red); width: 100%; box-sizing: border-box; }
        .v-fill { height: 6px; background: var(--sys-red); width: 0%; transition: 5.8s linear; margin-top: 10px; }
        
        /* Global Chat */
        #global-chat-container { width: 400px; height: 200px; border: 2px solid var(--sys-blue); background: rgba(0,0,0,0.8); display: none; flex-direction: column; margin-top: 10px; z-index: 2000; }
        #chat-messages { flex-grow: 1; overflow-y: auto; padding: 5px; font-size: 12px; font-family: 'Orbitron'; }
        .chat-input-row { display: flex; border-top: 1px solid var(--sys-blue); }
        .chat-input-row input { flex-grow: 1; background: #000; border: none; color: white; padding: 10px; outline: none; }
        .chat-input-row button { background: var(--sys-blue); border: none; padding: 5px 15px; cursor: pointer; font-weight: 900; }
        
        /* Victory Screen */
        #victory-screen { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; text-align: center;}
        
        /* Gate List Styling */
        .gate-item { padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; width: 100%; box-sizing: border-box; }
        .gate-item:hover { background: rgba(0, 210, 255, 0.1); }
    </style>
</head>
<body>

    <audio id="bgm" loop></audio>

    <div id="victory-screen">
        <h1 style="font-size: 5rem; color: var(--sys-gold); text-shadow: 0 0 20px var(--sys-gold);">QUEST COMPLETE</h1>
        <h2 id="winner-name" style="font-size: 3rem; color: #fff;">---</h2>
        <div id="mp-deduction-info" style="color: var(--sys-red); font-family: 'Orbitron'; font-size: 1.5rem; margin-bottom: 10px;"></div>
        <p id="return-timer" style="color: var(--sys-blue); font-family: 'Orbitron';">Returning to Profile in 5...</p>
    </div>

    <div id="global-chat-container">
        <div id="chat-messages"></div>
        <div class="chat-input-row">
            <input type="text" id="chat-input" placeholder="SYSTEM MESSAGE..." onkeydown="if(event.key==='Enter') sendChatMessage()">
            <button onclick="sendChatMessage()">SEND</button>
        </div>
    </div>

    <div id="screen-auth" class="screen active">
        <h1 style="font-size: 4rem; letter-spacing: 15px;">SYSTEM</h1>
        <div id="auth-msg" style="color:var(--sys-red); font-family: 'Orbitron'; font-size:12px; height:20px; margin-bottom:5px;"></div>
        <input type="text" id="u" class="sys-input" placeholder="HUNTER ID">
        <input type="password" id="p" class="sys-input" placeholder="ACCESS CODE">
        <button class="sys-btn" onclick="auth('login')">LOGIN</button>
        <button class="sys-btn" style="border-color:#444;" onclick="auth('signup')">REGISTER</button>
    </div>

    <div id="screen-menu" class="screen">
        <div style="position:absolute; right:40px; top:20px; text-align:right;">
            <h1 id="st-name" style="font-size: 2.8rem; margin:0;">---</h1>
            <div id="st-world-rank" style="font-size: 1.2rem; font-weight: 900; color: var(--sys-gold); margin: 5px 0;">WORLD RANK: #--</div>
            <div id="st-stats" style="font-size: 1rem; color: #aaa; margin-bottom: 5px;">WINS: 0 | LOSSES: 0</div>
            <div id="st-rank" style="font-size: 1.8rem; font-weight: 900; margin:0;">---</div>
            <div id="st-mp" style="font-size: 1.2rem; margin:0; color:var(--sys-blue);">HuP: ---</div>
            
            <div id="admin-panel" style="display:none; flex-direction:column; gap:5px; margin-top:15px; border:2px solid var(--sys-red); padding:10px; background:rgba(20,0,0,0.8); text-align:left;">
                <h3 style="color:var(--sys-red); margin:0; font-size:12px;">ADMIN CONTROLS</h3>
                <input id="admin-target" class="sys-input" placeholder="KICK PLAYER" style="width:120px; height:15px; font-size:10px;">
                <button class="sys-btn" style="width:145px; height:33px; font-size:10px; border-color:var(--sys-red);" onclick="doAdmin('kick')">KICK HUNTER</button>
                <input id="admin-watch-target" class="sys-input" placeholder="WATCH PLAYER" style="width:120px; height:15px; font-size:10px;">
                <button class="sys-btn" style="width:145px; height:33px; font-size:10px; border-color:var(--sys-gold);" onclick="doAdmin('spectate')">WATCH QUEST</button>
                <input id="admin-broadcast" class="sys-input" placeholder="GLOBAL MSG" style="width:120px; height:15px; font-size:10px;">
                <button class="sys-btn" style="width:145px; height:33px; font-size:10px;" onclick="doAdmin('broadcast')">BROADCAST</button>
            </div>
        </div>

        <div style="border:2px solid var(--sys-blue); width:400px; padding:20px; background:rgba(0,0,0,0.8);">
            <h3>WORLD RANKINGS</h3>
            <div id="world-rank-list" style="max-height: 300px; overflow-y: auto;"></div>
            <button class="sys-btn" style="width:100%; font-size:10px; height:30px; border-color:var(--sys-blue);" onclick="toggleRankLimit()">TOGGLE LIMIT</button>
        </div>

        <div id="menu-chat-anchor" style="height: 210px; width: 400px; margin-top: 10px;"></div>
        <button class="sys-btn" onclick="showScreen('screen-difficulty')">SINGLE PLAYER</button>
        <button class="sys-btn" onclick="openOnlineLobby()">MULTIPLAYER</button>
        <button class="sys-btn" style="border-color:#555;" onclick="doLogout()">LOGOUT</button>
    </div>

    <div id="screen-waiting" class="screen">
        <h2 id="waiting-title">GATE: ---</h2>
        <div id="waiting-list" style="width: 500px; min-height: 200px; border: 2px solid var(--sys-blue); padding: 20px; background: rgba(0,0,0,0.8);"></div>
        <div id="waiting-chat-anchor" style="width: 500px; height: 200px; margin-top: 10px;"></div>
        <button class="sys-btn" id="btn-ready" onclick="playerConfirm()">READY / START</button>
        <button class="sys-btn" style="border-color:#555" onclick="showScreen('screen-lobby')">LEAVE GATE</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h2>GATE SELECTION</h2>
        <input type="text" id="gate-name-input" class="sys-input" placeholder="GATE NAME">
        <button class="sys-btn" onclick="createGate()">OPEN GATE</button>
        <div id="gate-list" style="width: 600px; height: 300px; border: 2px solid var(--sys-blue); overflow-y: auto; background: rgba(0,0,0,0.8);"></div>
        <div id="lobby-chat-anchor" style="width: 400px; height: 200px; margin-top:10px;"></div>
        <button class="sys-btn" onclick="showScreen('screen-menu')">BACK</button>
    </div>

    <div id="screen-difficulty" class="screen">
        <h2>QUEST TYPE</h2>
        <button class="sys-btn" onclick="startAI('Easy')">EASY</button>
        <button class="sys-btn" onclick="startAI('Hard')">HARD</button>
        <button class="sys-btn" onclick="startAI('Monarch')" style="color:red; border-color:red;">MONARCH (+5 MP)</button>
        <button class="sys-btn" onclick="showScreen('screen-menu')">BACK</button>
    </div>

    <div id="screen-game" class="screen" style="flex-direction: row; align-items: center; justify-content: center;">
        
        <div class="hud-left">
            <h3 id="turn-txt" style="color:var(--sys-gold);">>> SYSTEM TURN</h3>
            <div id="party-list"></div>
            <div id="game-chat-anchor" style="height: 300px; width: 100%; margin-top:20px;"></div>
        </div>
        
        <div style="display:flex; flex-direction: column; align-items: center; padding: 0 20px;">
            <div id="game-board"></div>
        </div>

        <div class="hud-right">
            <div id="vs-panel">
                <span id="vs-title" style="color:red; font-weight:900;">COMBAT INITIATED</span>
                <div id="vs-data" style="font-size: 18px; text-align: center; margin: 10px 0;"></div>
                <div style="width:100%; height:4px; background:#111;"><div class="v-fill" id="vs-fill"></div></div>
            </div>
            
            <div id="announcement-board" style="width:100%; background:#050505; height: 150px; font-size:12px; margin-bottom:10px; padding:10px; border:1px solid #222; overflow-y:auto;"></div>
            
            <div class="rank-guide-title">HUNTER RANK GUIDE</div>
            <table class="rank-guide-table">
                <tr><td style="color:var(--sys-red)">Higher S-Rank</td><td>1000+</td></tr>
                <tr><td style="color:var(--sys-red)">Lower S-Rank</td><td>901-999</td></tr>
                <tr><td style="color:var(--sys-silver)">Higher A-Rank</td><td>801-900</td></tr>
                <tr><td style="color:var(--sys-silver)">Lower A-Rank</td><td>701-800</td></tr>
                <tr><td style="color:var(--sys-gold)">Higher B-Rank</td><td>601-700</td></tr>
                <tr><td style="color:var(--sys-gold)">Lower B-Rank</td><td>501-600</td></tr>
                <tr><td style="color:var(--sys-blue)">Higher C-Rank</td><td>401-500</td></tr>
                <tr><td style="color:var(--sys-blue)">Lower C-Rank</td><td>301-400</td></tr>
                <tr><td style="color:var(--sys-green)">Higher D-Rank</td><td>201-300</td></tr>
                <tr><td style="color:var(--sys-green)">Lower D-Rank</td><td>101-200</td></tr>
                <tr><td>Higher E-Rank</td><td>51-100</td></tr>
                <tr><td>Lower E-Rank</td><td>0-50</td></tr>
            </table>

            <button class="sys-btn" style="width:100%; margin: 15px 0 0 0;" onclick="quitAction()">QUIT QUEST</button>
        </div>
    </div>

    <script>
        const socket = io();
        let myHunter = null, myRoomID = 'global', currentPass = "", currentBGM = "", currentWorldRankings = [], showingFullRankings = false, currentGateID = null;

        function playMusic(track) {
            const audio = document.getElementById('bgm');
            if (currentBGM === track) return;
            currentBGM = track;
            audio.src = `/music/${track}`;
            audio.play().catch(e => {});
        }

        function auth(type) {
            const u = document.getElementById('u').value, p = document.getElementById('p').value;
            if(!u || !p) return;
            currentPass = p;
            socket.emit('authRequest', { type, u, p });
        }

        socket.on('authSuccess', (d) => {
            myHunter = d;
            document.getElementById('st-name').innerText = d.username;
            document.getElementById('st-rank').innerText = d.rank;
            document.getElementById('st-rank').style.color = d.color;
            document.getElementById('st-mp').innerText = `HuP: ${d.mana}`;
            document.getElementById('st-stats').innerText = `WINS: ${d.wins} | LOSSES: ${d.losses}`;
            document.getElementById('st-world-rank').innerText = `WORLD RANK: #${d.worldRank}`;
            document.getElementById('admin-panel').style.display = d.isAdmin ? 'flex' : 'none';
            if(d.isAdmin) document.getElementById('st-name').classList.add('admin-glow');
            showScreen('screen-menu');
        });

        socket.on('authError', (msg) => {
            document.getElementById('auth-msg').innerText = msg;
            if(msg.includes("FORCED LOGOUT")) { alert(msg); location.reload(); }
        });

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-menu') { moveChat('menu-chat-anchor'); playMusic('menu.mp3'); myRoomID = 'global'; }
            else if(id === 'screen-lobby') { moveChat('lobby-chat-anchor'); }
            else if(id === 'screen-waiting') { moveChat('waiting-chat-anchor'); }
            else if(id === 'screen-game') { moveChat('game-chat-anchor'); playMusic('gameplay.mp3'); }
        }

        function moveChat(anchorId) {
            const chat = document.getElementById('global-chat-container');
            chat.style.display = 'flex';
            document.getElementById(anchorId).appendChild(chat);
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            if (input.value.trim() !== "" && myHunter) {
                socket.emit('sendMessage', { message: input.value, senderName: myHunter.username, roomId: myRoomID });
                input.value = "";
            }
        }

        socket.on('receiveMessage', (data) => {
            const chatBox = document.getElementById('chat-messages');
            const msg = document.createElement('div');
            if(data.isAdmin) msg.className = "admin-chat-msg";
            const crown = data.isAdmin ? 'ðŸ‘‘' : '';
            msg.innerHTML = `<b>[${data.rank}] ${crown}${data.sender}:</b> ${data.text}`;
            chatBox.appendChild(msg);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        socket.on('updateWorldRankings', (l) => {
            currentWorldRankings = l;
            const list = document.getElementById('world-rank-list');
            list.innerHTML = l.slice(0, showingFullRankings?100:10).map((h, i) => {
                let color = '#fff';
                if(i < 3) color = 'var(--sys-gold)';
                else if(i < 10) color = 'var(--sys-red)';
                const adminClass = h.isAdmin ? "class='admin-glow'" : "";
                return `<div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #222; color:${color}; font-weight:900;">
                    <span ${adminClass}>#${i+1} ${h.username}</span><span>${h.hunterpoints} HuP</span>
                </div>`;
            }).join('');
        });

        function toggleRankLimit() { showingFullRankings = !showingFullRankings; socket.emit('requestWorldRankings'); }

        // MULTIPLAYER LOGIC
        function openOnlineLobby() { showScreen('screen-lobby'); socket.emit('requestGateList'); }
        
        function createGate() {
            const name = document.getElementById('gate-name-input').value;
            if(name) socket.emit('createGate', { host: myHunter.username, name });
        }
        
        function joinGate(id) { socket.emit('joinGate', { gateID: id, user: myHunter.username }); }
        
        function playerConfirm() { if(currentGateID) socket.emit('playerConfirm', { gateID: currentGateID }); }

        socket.on('updateGateList', (list) => {
            const container = document.getElementById('gate-list');
            // Fix: Clear list before updating to prevent ghost entries
            container.innerHTML = "";
            container.innerHTML = list.map(g => `<div class="gate-item" onclick="joinGate('${g.id}')"><span>${g.name}</span><span style="color:var(--sys-blue)">${g.count}/4 HUNTERS</span></div>`).join('');
        });

        socket.on('waitingRoomUpdate', (room) => {
            currentGateID = room.id;
            showScreen('screen-waiting');
            document.getElementById('waiting-title').innerText = `GATE: ${room.name}`;
            const container = document.getElementById('waiting-list');
            container.innerHTML = room.players.map(p => `<div style="padding:10px; border-bottom:1px solid #333; display:flex; justify-content:space-between; color:${p.color}"><span>${p.isAdmin?'ðŸ‘‘':''}${p.name} (${p.worldsRankLabel})</span><span>${p.confirmed ? 'READY' : 'WAITING'}</span></div>`).join('');
            const me = room.players.find(p => p.id === socket.id);
            document.getElementById('btn-ready').innerText = (me && me.confirmed) ? "WAITING..." : "READY / START";
        });

        // GAMEPLAY ACTIONS
        function quitAction() { socket.emit('quitGame'); }
        function startAI(diff) { socket.emit('startSoloAI', { user: myHunter.username, diff }); }

        socket.on('gameStart', (d) => { myRoomID = d.roomId; showScreen('screen-game'); });

        socket.on('gameStateUpdate', (s) => {
            const board = document.getElementById('game-board');
            board.innerHTML = "";
            const me = s.players.find(p => p.id === socket.id);
            const isTurn = s.players[s.turn].id === socket.id;

            document.getElementById('turn-txt').innerText = isTurn ? ">> YOUR MOVE" : `>> ${s.players[s.turn].name.toUpperCase()} ACTING`;
            
            document.getElementById('party-list').innerHTML = s.players.map(p => `
                <div class="party-member" style="color:${p.quit ? '#444' : p.color}">
                    <div ${p.isAdmin ? "class='admin-glow'":""}>${p.isAdmin?'ðŸ‘‘':''}${p.name}</div>
                    <div style="font-size:12px;">MP: ${p.mana} ${p.alive?'':'(KIA)'}</div>
                    <div style="font-size:10px; color:#888;">${p.rankLabel || ''}</div>
                </div>`).join('');

            for(let y=0; y<15; y++) {
                for(let x=0; x<15; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if(s.world[`${x}-${y}`]) cell.style.backgroundColor = s.world[`${x}-${y}`].color;
                    
                    const dist = me ? Math.abs(me.x - x) + Math.abs(me.y - y) : 0;
                    // FIX: Safety check for 'me' existence to prevent freezing on dead/spectator clients
                    const limit = me ? (me.stepLimit || 1) : 0;
                    
                    if(isTurn && me && me.alive && dist <= limit && dist > 0) {
                        cell.classList.add('valid-move');
                        cell.onclick = () => socket.emit('playerAction', { tx: x, ty: y });
                    }
                    s.players.forEach(p => {
                        if(p.alive && p.x === x && p.y === y) {
                            const h = document.createElement('div');
                            h.className = 'humanoid';
                            h.innerHTML = `<div class="name-tag ${p.isAdmin ? 'admin-glow' : ''}" style="color:${p.color}">${p.isAdmin?'ðŸ‘‘':''}${p.name}</div>
                                           <div class="h-head" style="background:${p.color}"></div>
                                           <div class="h-body" style="background:${p.color}"></div>`;
                            cell.appendChild(h);
                        }
                    });
                    board.appendChild(cell);
                }
            }
        });

        socket.on('battleStart', (data) => {
            document.getElementById('vs-panel').style.display = 'flex';
            document.getElementById('vs-fill').style.transition = 'none';
            document.getElementById('vs-fill').style.width = '0%';
            void document.getElementById('vs-fill').offsetWidth;
            document.getElementById('vs-fill').style.transition = '5.8s linear';
            document.getElementById('vs-fill').style.width = '100%';
            document.getElementById('vs-data').innerHTML = `<span style="color:${data.hunterColor}">${data.hunter}</span> VS <span style="color:${data.targetColor}">${data.target}</span><br><small>${data.targetRank}</small>`;
        });

        socket.on('battleEnd', () => { document.getElementById('vs-panel').style.display = 'none'; });

        socket.on('announcement', (msg) => {
            const board = document.getElementById('announcement-board');
            board.innerHTML = `<div style="color:var(--sys-gold); margin-bottom:4px;">[SYSTEM]: ${msg}</div>` + board.innerHTML;
        });

        socket.on('victoryEvent', (data) => {
            const vs = document.getElementById('victory-screen');
            vs.style.display = 'flex';
            document.getElementById('winner-name').innerText = data.winner;
            const isMe = myHunter && data.winner === myHunter.username;
            
            // FIX: Display specific points if available (Monarch +5, PvP +20)
            const pts = data.points || 20; 
            
            if (isMe) {
                 document.getElementById('mp-deduction-info').innerText = `VICTORY: +${pts} HuP`;
                 document.getElementById('mp-deduction-info').style.color = "var(--sys-green)";
            } else {
                 document.getElementById('mp-deduction-info').innerText = "HUNTER KIA: MANA DEDUCTED";
                 document.getElementById('mp-deduction-info').style.color = "var(--sys-red)";
            }
        });

        socket.on('returnToProfile', () => { showScreen('screen-menu'); document.getElementById('victory-screen').style.display = 'none'; });

        function doAdmin(action) {
            if(action === 'kick') socket.emit('adminAction', { action: 'kick', target: document.getElementById('admin-target').value });
            if(action === 'spectate') socket.emit('adminAction', { action: 'spectate', targetName: document.getElementById('admin-watch-target').value });
            if(action === 'broadcast') { socket.emit('adminAction', { action: 'broadcast', message: document.getElementById('admin-broadcast').value }); document.getElementById('admin-broadcast').value = ""; }
        }

        function doLogout() { sessionStorage.clear(); location.reload(); }
    </script>
</body>
</html>

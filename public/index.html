<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOLO LEVELING BOARD GAME</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@1,900&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --sys-blue:#00d2ff; --sys-red:#ff003c; --sys-gold:#ffcc00; --sys-silver:#c0c0c0; }
        body { background:#000; color:white; font-family:'Exo 2',sans-serif; margin:0; overflow:hidden; }
        h1,h2,h3 { font-family:'Orbitron'; font-style:italic; color:var(--sys-blue); text-shadow:0 0 10px var(--sys-blue); }
        .screen { display:none; flex-direction:column; align-items:center; justify-content:center; height:100vh; width:100vw; position:absolute; }
        .active { display:flex!important; }
        .sys-btn { background:#000; border:2px solid var(--sys-blue); color:var(--sys-blue); padding:10px 40px; font-family:'Orbitron'; cursor:pointer; margin:10px; font-weight:900; clip-path:polygon(15% 0,100% 0,85% 100%,0 100%); width:250px; text-transform:uppercase; transition:.2s; }
        .sys-btn:hover { background:var(--sys-blue); color:#000; }
        .sys-input { padding:15px; background:#000; border:1px solid var(--sys-blue); color:#fff; width:300px; margin:10px; font-family:'Orbitron'; outline:none; }

        #game-board { display:grid; grid-template-columns:repeat(15,42px); gap:2px; background:#111; border:4px solid var(--sys-blue); }
        .cell { width:42px; height:42px; background:#000; position:relative; border:.5px solid #1a1a1a; }
        .valid-move { box-shadow:inset 0 0 0 3px var(--sys-blue); cursor:pointer; z-index:5; }

        .humanoid { position:absolute; bottom:5px; left:50%; transform:translateX(-50%); width:24px; height:30px; z-index:10; pointer-events:none; }
        .h-head { width:10px; height:10px; border-radius:50%; border:1px solid white; margin:0 auto; }
        .h-body { width:20px; height:15px; border:1px solid white; border-radius:4px 4px 0 0; }

        .name-tag { position:absolute; top:-22px; left:50%; transform:translateX(-50%); font-size:10px; white-space:nowrap; font-weight:900; background:#000; border:1px solid #444; padding:1px 4px; display:flex; flex-direction:column; align-items:center; }

        .hud-left { width:280px; background:rgba(0,0,0,.9); border-right:2px solid var(--sys-blue); padding:15px; display:flex; flex-direction:column; height:650px; overflow-y:auto; }

        .sidebar { width:350px; border:2px solid var(--sys-blue); background:#000; padding:15px; height:650px; display:flex; flex-direction:column; }

        /* ================= CHAT SYSTEM ================= */
        .chat-box { flex-grow:1; background:#020202; border:1px solid #222; margin-top:10px; display:flex; flex-direction:column; }
        .chat-log { flex-grow:1; overflow-y:auto; padding:8px; font-size:11px; }
        .chat-msg { margin-bottom:6px; }
        .chat-user { font-weight:900; color:var(--sys-blue); }
        .chat-input-area { display:flex; border-top:1px solid #222; }
        .chat-input-area input {
            flex-grow:1; background:#000; border:none; color:white;
            padding:8px; font-family:'Orbitron'; font-size:11px; outline:none;
        }
        .chat-input-area button {
            background:var(--sys-blue); border:none; color:#000;
            font-weight:900; font-family:'Orbitron'; padding:0 15px; cursor:pointer;
        }
        /* =============================================== */

        #victory-screen { display:none; position:fixed; inset:0; background:rgba(0,0,0,.95); z-index:10000; flex-direction:column; align-items:center; justify-content:center; }
    </style>
</head>
<body>

<div id="screen-game" class="screen" style="flex-direction:row; justify-content:center; align-items:center;">
    <div style="display:flex; gap:20px;">
        <div id="game-board"></div>
        <div class="sidebar">
            <h3 id="turn-txt" style="color:var(--sys-gold); font-size:14px;">>> SYSTEM TURN</h3>
            <div id="party-list"></div>

            <div id="announcement-board" style="flex-grow:1; background:#050505; font-size:11px; margin-top:10px; overflow-y:auto; padding:10px; border:1px solid #222;"></div>

            <!-- CHAT UI -->
            <div class="chat-box">
                <div id="chat-log" class="chat-log"></div>
                <div class="chat-input-area">
                    <input id="chat-input" type="text" placeholder="TRANSMIT MESSAGE..." />
                    <button onclick="sendChat()">SEND</button>
                </div>
            </div>

            <button class="sys-btn" style="width:100%; height:45px; font-size:12px; margin-top:10px;" onclick="quitAction()">QUIT QUEST</button>
        </div>
    </div>
</div>

<script>
const socket = io();
let myHunter = null;

/* ================= CHAT LOGIC ================= */
function sendChat() {
    const input = document.getElementById('chat-input');
    const msg = input.value.trim();
    if (!msg || !myHunter) return;

    socket.emit('chatMessage', {
        user: myHunter.username,
        message: msg
    });
    input.value = "";
}

document.getElementById('chat-input')?.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendChat();
});

socket.on('chatMessage', data => {
    const log = document.getElementById('chat-log');
    if (!log) return;

    log.innerHTML += `
        <div class="chat-msg">
            <span class="chat-user">${data.user}:</span>
            <span>${data.message}</span>
        </div>
    `;
    log.scrollTop = log.scrollHeight;
});
/* ============================================== */
</script>

</body>
</html>
